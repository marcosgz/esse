#!/bin/bash
set -e

service_name="$1"
service_version="$2"
if [ -z "${service_name}" ] || [ -z "${service_version}" ]; then
  echo "Usage: $0 <service_name> <service_version>"
  echo "-> Example: $0 elasticsearch v7"
  exit 1
fi

shift; shift;

unset DOCKER_IMAGE
unset SERVICE_TYPE

case "${service_name}-${service_version}" in
  elasticsearch-v1)
    export STACK_VERSION=1.7.6
    export DOCKER_IMAGE=elasticsearch
    ;;
  elasticsearch-v2)
    export STACK_VERSION=2.3.1
    export DOCKER_IMAGE=elasticsearch
    ;;
  elasticsearch-v5)
    export STACK_VERSION=5.6.16
    ;;
  elasticsearch-v6)
    export STACK_VERSION=6.8.16
    ;;
  elasticsearch-v7)
    export STACK_VERSION=7.13.2
    ;;
  elasticsearch-v8)
    export STACK_VERSION=8.2.1
    ;;
  opensearch-v1)
    export STACK_VERSION=1.3.3
    export DOCKER_IMAGE=opensearchproject/opensearch
    export SERVICE_TYPE=opensearch
    ;;
  opensearch-v2)
    export STACK_VERSION=2.0.1
    export DOCKER_IMAGE=opensearchproject/opensearch
    export SERVICE_TYPE=opensearch
    ;;
  *)
    echo -e "\033[31;1mERROR:\033[0m Unknown service type [${service_name}] and/or version [${service_version}]"
    exit 1
    ;;
esac

$@
